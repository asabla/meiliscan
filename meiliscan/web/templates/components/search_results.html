{% if error %}
<!-- Error State -->
<div class="alert alert-error">
    <strong>Error:</strong> {{ error }}
</div>

{% elif results %}
<!-- Search Metadata -->
<div class="flex items-center justify-between mb-2" style="flex-wrap: wrap; gap: 1rem;">
    <div class="flex items-center gap-2">
        <span class="badge badge-blue">
            {{ results.estimatedTotalHits or results.totalHits or 0 }} results
        </span>
        <span class="text-muted" style="font-size: 0.875rem;">
            in {{ results.processingTimeMs }}ms
        </span>
    </div>
    
    {% if search_params %}
    <div class="text-muted" style="font-size: 0.75rem;">
        {% if search_params.get('q') %}
            Query: <code>{{ search_params.get('q') }}</code>
        {% endif %}
        {% if search_params.get('filter') %}
            | Filter: <code>{{ search_params.get('filter') }}</code>
        {% endif %}
        {% if search_params.get('sort') %}
            | Sort: <code>{{ search_params.get('sort')[0] }}</code>
        {% endif %}
    </div>
    {% endif %}
</div>

{% if results.hits %}
<!-- Results List -->
<div class="search-results-list">
    {% for hit in results.hits %}
    <div class="search-result-item">
        <div class="search-result-header" onclick="toggleSearchResult(this)">
            <span class="search-result-toggle">‚ñ∂</span>
            <span class="search-result-title">
                {% if hit.get('title') %}
                    {{ hit.title }}
                {% elif hit.get('name') %}
                    {{ hit.name }}
                {% elif hit.get('id') %}
                    Document #{{ hit.id }}
                {% else %}
                    Document {{ loop.index }}
                {% endif %}
            </span>
            {% if hit.get('_rankingScore') %}
            <span class="badge badge-green" style="margin-left: auto; font-size: 0.7rem;">
                Score: {{ "%.3f"|format(hit._rankingScore) }}
            </span>
            {% endif %}
        </div>
        <div class="search-result-content" style="display: none;">
            <pre class="json-preview"><code>{{ hit | tojson(indent=2) }}</code></pre>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
{% set total_hits = results.estimatedTotalHits or results.totalHits or 0 %}
{% set hits_per_page = search_params.get('hitsPerPage', 20) %}
{% set current_page = search_params.get('page', 1) %}
{% set total_pages = ((total_hits + hits_per_page - 1) // hits_per_page) %}

{% if total_pages > 1 %}
<div class="pagination mt-2">
    <div class="flex items-center justify-center gap-1">
        {% if current_page > 1 %}
        <button class="btn btn-sm" data-page="{{ current_page - 1 }}">‚Üê Prev</button>
        {% else %}
        <button class="btn btn-sm" disabled>‚Üê Prev</button>
        {% endif %}
        
        <span class="text-muted" style="margin: 0 1rem;">
            Page {{ current_page }} of {{ total_pages }}
        </span>
        
        {% if current_page < total_pages %}
        <button class="btn btn-sm" data-page="{{ current_page + 1 }}">Next ‚Üí</button>
        {% else %}
        <button class="btn btn-sm" disabled>Next ‚Üí</button>
        {% endif %}
    </div>
</div>
{% endif %}

{% else %}
<!-- No Results -->
<div class="empty-state" style="padding: 2rem;">
    <div class="empty-state-icon">üîç</div>
    <h3>No Results Found</h3>
    <p class="text-muted">Try adjusting your search query or filters.</p>
</div>
{% endif %}

{% else %}
<!-- No Search Performed Yet -->
<p class="text-muted">Enter a search query and click "Search" to see results.</p>
{% endif %}

<script>
function toggleSearchResult(header) {
    const content = header.nextElementSibling;
    const toggle = header.querySelector('.search-result-toggle');
    
    if (content.style.display === 'none') {
        content.style.display = 'block';
        toggle.textContent = '‚ñº';
        header.classList.add('expanded');
    } else {
        content.style.display = 'none';
        toggle.textContent = '‚ñ∂';
        header.classList.remove('expanded');
    }
}
</script>
