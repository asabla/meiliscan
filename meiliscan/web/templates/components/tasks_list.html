{% if error %}
<div class="alert alert-error">
    <strong>Error:</strong> {{ error }}
</div>
{% elif tasks %}
<div class="tasks-table-wrapper">
    <table class="tasks-table" id="tasks-table">
        <thead>
            <tr>
                <th class="sortable w-20" data-sort="uid" data-type="number" onclick="sortTable('uid', 'number')">
                    UID<span class="sort-icon"></span>
                </th>
                <th class="sortable w-28" data-sort="status" data-type="string" onclick="sortTable('status', 'string')">
                    Status<span class="sort-icon"></span>
                </th>
                <th class="sortable w-44" data-sort="type" data-type="string" onclick="sortTable('type', 'string')">
                    Type<span class="sort-icon"></span>
                </th>
                <th class="sortable w-32" data-sort="index" data-type="string" onclick="sortTable('index', 'string')">
                    Index<span class="sort-icon"></span>
                </th>
                <th class="w-auto min-w-20">Details</th>
                <th class="sortable w-28" data-sort="duration" data-type="duration" onclick="sortTable('duration', 'duration')">
                    Duration<span class="sort-icon"></span>
                </th>
                <th class="sortable sort-desc w-44" data-sort="enqueued" data-type="date" onclick="sortTable('enqueued', 'date')">
                    Enqueued At<span class="sort-icon"></span>
                </th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr class="task-row task-{{ task.status.value }}"
                data-uid="{{ task.uid }}"
                data-status="{{ task.status.value }}"
                data-type="{{ task.task_type }}"
                data-index="{{ task.index_uid or '' }}"
                data-duration="{{ task.duration_ms or 0 }}"
                data-enqueued="{{ task.enqueued_at.isoformat() }}">
                <td class="task-uid">{{ task.uid }}</td>
                <td>
                    <span class="task-status task-status-{{ task.status.value }}">
                        {% if task.status.value == 'succeeded' %}
                        <span class="status-icon">&#10003;</span>
                        {% elif task.status.value == 'failed' %}
                        <span class="status-icon">&#10007;</span>
                        {% elif task.status.value == 'processing' %}
                        <span class="status-icon spinning">&#8635;</span>
                        {% elif task.status.value == 'enqueued' %}
                        <span class="status-icon">&#8987;</span>
                        {% elif task.status.value == 'canceled' %}
                        <span class="status-icon">&#8856;</span>
                        {% endif %}
                        {{ task.status.value }}
                    </span>
                </td>
                <td>
                    <code class="task-type">{{ task.task_type }}</code>
                </td>
                <td>
                    {% if task.index_uid %}
                    <a href="/index/{{ task.index_uid }}">{{ task.index_uid }}</a>
                    {% else %}
                    <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>
                    <div class="task-details-inner">
                    {% if task.details %}
                        {% if task.details.get('receivedDocuments') is not none %}
                        <span class="badge badge-blue">{{ task.details.receivedDocuments }} docs</span>
                        {% endif %}
                        {% if task.details.get('deletedDocuments') is not none %}
                        <span class="badge badge-yellow">{{ task.details.deletedDocuments }} deleted</span>
                        {% endif %}
                        {% if task.details.get('indexedDocuments') is not none and task.details.get('receivedDocuments') != task.details.get('indexedDocuments') %}
                        <span class="badge badge-green">{{ task.details.indexedDocuments }} indexed</span>
                        {% endif %}
                        {% if task.details.get('primaryKey') %}
                        <span class="badge badge-gray">pk: {{ task.details.primaryKey }}</span>
                        {% endif %}
                    {% endif %}
                    {% if task.error %}
                    <span class="badge badge-red" title="{{ task.error.message }}">{{ task.error.code or 'error' }}</span>
                    {% endif %}
                    </div>
                </td>
                <td>
                    <span class="task-duration">{{ task.format_duration() }}</span>
                </td>
                <td>
                    <span class="task-time" title="{{ task.enqueued_at.isoformat() }}">
                        {{ task.enqueued_at.strftime('%Y-%m-%d %H:%M:%S') }}
                    </span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if next_uid is not none %}
<div class="pagination mt-2">
    <div class="flex items-center justify-center">
        <button class="btn btn-secondary btn-sm"
                hx-get="/tasks/list?from_uid={{ next_uid }}&status={{ current_status or '' }}&task_type={{ current_type or '' }}&index={{ current_index or '' }}"
                hx-target="#tasks-list"
                hx-swap="innerHTML">
            Load More
        </button>
    </div>
</div>
{% endif %}

{% else %}
<div class="empty-state" style="padding: 2rem;">
    <div class="empty-state-icon">&#128203;</div>
    <h3>No Tasks Found</h3>
    <p class="text-muted">
        {% if current_status or current_type or current_index %}
        No tasks match the current filters.
        {% else %}
        No tasks have been recorded yet.
        {% endif %}
    </p>
</div>
{% endif %}
